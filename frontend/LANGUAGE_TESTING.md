# 语言切换功能测试指南

## 测试步骤

### 1. 启动开发服务器

```bash
cd frontend
npm run dev
```

### 2. 测试默认语言检测

#### 测试场景 A：清除 Cookie 后的浏览器语言检测

1. 打开浏览器开发者工具（F12）
2. 进入 Application/Storage > Cookies
3. 删除 `app_language` cookie（如果存在）
4. 刷新页面
5. **预期结果**：
   - 如果浏览器语言是中文（zh-CN, zh-TW 等），页面应显示中文
   - 如果浏览器语言是其他语言，页面应显示英文

#### 测试场景 B：修改浏览器语言设置

1. 在浏览器设置中修改首选语言为中文
2. 清除 `app_language` cookie
3. 刷新页面
4. **预期结果**：页面应显示中文

### 3. 测试语言切换功能

#### 在登录页面测试

1. 访问登录页面 `http://localhost:5173/login`
2. 查看右上角的语言切换按钮
3. 点击语言切换按钮
4. 选择另一种语言（中文 ↔ 英文）
5. **预期结果**：
   - 页面文本立即切换到所选语言
   - 无需刷新页面
   - 检查以下元素是否正确翻译：
     - 页面标题（"Agent Platform" / "智能体平台"）
     - 副标题（"Sign in to your account" / "登录您的账户"）
     - 表单标签（"Username" / "用户名", "Password" / "密码"）
     - 按钮文本（"Sign in" / "登录"）
     - 版权信息

#### 在主界面测试

1. 登录系统
2. 进入任意页面（如 Agents 列表页）
3. 查看 Header 右侧的语言切换按钮（在用户菜单左侧）
4. 点击语言切换按钮
5. 选择另一种语言
6. **预期结果**：
   - 页面文本立即切换
   - 检查以下元素：
     - 页面标题（"Agents" / "智能体"）
     - 页面描述
     - Tab 标签（"Created" / "已创建", "Employed" / "已雇佣", "Visible" / "可见"）
     - 按钮文本（"Edit" / "编辑", "Delete" / "删除" 等）
     - 分页控件（"Previous" / "上一页", "Next" / "下一页"）

### 4. 测试 Cookie 持久化

1. 选择一种语言（例如中文）
2. 刷新页面
3. **预期结果**：页面仍然显示中文
4. 关闭浏览器
5. 重新打开浏览器并访问应用
6. **预期结果**：页面仍然显示中文（Cookie 有效期 365 天）

### 5. 测试跨页面语言一致性

1. 在登录页面选择中文
2. 登录系统
3. **预期结果**：主界面也应该显示中文
4. 在不同页面间导航（Flows, Agents, Config 等）
5. **预期结果**：所有页面保持相同的语言设置

### 6. 验证 Cookie 存储

1. 打开浏览器开发者工具
2. 进入 Application/Storage > Cookies
3. 查找 `app_language` cookie
4. **预期结果**：
   - Cookie 名称：`app_language`
   - Cookie 值：`en` 或 `zh`
   - 过期时间：约 365 天后

## 已翻译的内容检查清单

### 登录页面
- [ ] 页面标题
- [ ] 登录提示文本
- [ ] 用户名标签
- [ ] 密码标签
- [ ] 登录按钮
- [ ] 版权信息

### 主界面 Header
- [ ] 退出登录按钮

### Agents 列表页
- [ ] 页面标题和描述
- [ ] 创建按钮
- [ ] Tab 标签（Created, Employed, Visible）
- [ ] 操作按钮（Edit, Copy, Delete, Tune, Fire, Interview, Employ）
- [ ] 空状态提示
- [ ] 分页控件
- [ ] 确认对话框文本
- [ ] 成功/错误提示信息

## 常见问题排查

### 问题 1：语言切换后没有变化
- 检查浏览器控制台是否有错误
- 确认翻译文件中是否有对应的键值
- 检查组件是否正确使用了 `useTranslation` hook

### 问题 2：刷新后语言恢复默认
- 检查浏览器是否允许 Cookie
- 查看开发者工具中 Cookie 是否正确设置
- 确认 Cookie 域名和路径设置正确

### 问题 3：某些文本没有翻译
- 检查该文本是否在翻译文件中定义
- 确认组件是否使用了 `t()` 函数
- 查看是否有硬编码的文本需要替换

## 浏览器兼容性测试

建议在以下浏览器中测试：
- [ ] Chrome/Edge (最新版本)
- [ ] Firefox (最新版本)
- [ ] Safari (最新版本)

## 性能检查

1. 打开浏览器性能分析工具
2. 切换语言
3. **预期结果**：
   - 语言切换应该是即时的（< 100ms）
   - 不应该有明显的页面重绘或闪烁
   - 内存使用应该保持稳定

## 自动化测试建议

可以编写以下自动化测试：
```typescript
// 示例：测试语言切换
describe('Language Switching', () => {
  it('should switch to Chinese when selected', () => {
    // 点击语言切换按钮
    // 选择中文
    // 验证页面文本是否为中文
  });

  it('should persist language selection in cookie', () => {
    // 选择语言
    // 刷新页面
    // 验证语言是否保持
  });

  it('should detect browser language on first visit', () => {
    // 清除 cookie
    // 设置浏览器语言
    // 访问页面
    // 验证显示的语言
  });
});
```
