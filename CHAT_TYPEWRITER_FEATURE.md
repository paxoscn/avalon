# èŠå¤©ç•Œé¢æ‰“å­—æœºæ•ˆæœå’Œæ€è€ƒè¿‡ç¨‹å±•ç¤º

## åŠŸèƒ½æ¦‚è¿°

èŠå¤©ç•Œé¢ç°åœ¨æ”¯æŒï¼š
1. **æ‰“å­—æœºæ•ˆæœ** - å®æ—¶æµå¼æ˜¾ç¤º AI å›å¤å†…å®¹
2. **æ€è€ƒè¿‡ç¨‹å±•ç¤º** - æ˜¾ç¤º AI çš„æ¨ç†è¿‡ç¨‹ï¼ˆreasoning_contentï¼‰
3. **ä¼˜é›…çš„ UI è®¾è®¡** - æ¸å˜è‰²ã€å›¾æ ‡å’ŒåŠ¨ç”»æ•ˆæœ

## å®ç°ç»†èŠ‚

### åç«¯æ”¯æŒ

åç«¯å·²ç»æ”¯æŒåœ¨ SSE æµä¸­è¿”å› `reasoning_content` å­—æ®µï¼š

```rust
// src/infrastructure/llm/streaming.rs
pub struct ChatStreamChunk {
    pub content: Option<String>,
    pub reasoning_content: Option<String>,  // æ€è€ƒè¿‡ç¨‹
    pub finish_reason: Option<FinishReason>,
    pub usage: Option<TokenUsage>,
}
```

### å‰ç«¯å®ç°

#### 1. Hook æ›´æ–° (`useAgentChatStream.ts`)

æ·»åŠ äº† `currentReasoning` çŠ¶æ€æ¥è·Ÿè¸ªæ€è€ƒè¿‡ç¨‹ï¼š

```typescript
const {
  messages,
  currentResponse,      // å½“å‰å›å¤å†…å®¹
  currentReasoning,     // å½“å‰æ€è€ƒè¿‡ç¨‹
  isStreaming,
  sessionId,
  sendMessage,
  cancelStream,
  clearMessages,
} = useAgentChatStream({ agentId });
```

#### 2. ç»„ä»¶æ›´æ–° (`AgentChatStream.tsx`)

**æ€è€ƒè¿‡ç¨‹å±•ç¤º**ï¼š
- ä½¿ç”¨ç¥ç€è‰²æ¸å˜èƒŒæ™¯
- æ˜¾ç¤ºæ—‹è½¬çš„æ€è€ƒå›¾æ ‡
- å®æ—¶æ›´æ–°æ€è€ƒå†…å®¹
- å¸¦æœ‰æ‰“å­—æœºå…‰æ ‡æ•ˆæœ

**å›å¤å†…å®¹å±•ç¤º**ï¼š
- ç™½è‰²èƒŒæ™¯å¡ç‰‡
- å®æ—¶æµå¼æ˜¾ç¤ºå†…å®¹
- è“è‰²æ‰“å­—æœºå…‰æ ‡

**æ¶ˆæ¯å†å²**ï¼š
- ç”¨æˆ·æ¶ˆæ¯ï¼šç»¿è‰²æ¸å˜èƒŒæ™¯
- AI æ¶ˆæ¯ï¼šç™½è‰²èƒŒæ™¯
- ä½¿ç”¨ emoji å›¾æ ‡ï¼ˆğŸ‘¤ ç”¨æˆ·ï¼ŒğŸ¤– AIï¼‰
- æ˜¾ç¤ºæ¨¡å‹ä¿¡æ¯å’Œ token ä½¿ç”¨é‡

## UI ç‰¹æ€§

### 1. æ€è€ƒè¿‡ç¨‹å¡ç‰‡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’­ æ€è€ƒè¿‡ç¨‹                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ æ­£åœ¨åˆ†æç”¨æˆ·é—®é¢˜...                  â”‚
â”‚ æ£€ç´¢ç›¸å…³çŸ¥è¯†...â–ˆ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å›å¤å†…å®¹å¡ç‰‡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ ¹æ®æ‚¨çš„é—®é¢˜ï¼Œæˆ‘å»ºè®®...â–ˆ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. æ¶ˆæ¯å†å²
```
ğŸ‘¤ [ç”¨æˆ·æ¶ˆæ¯ - ç»¿è‰²èƒŒæ™¯]
   ä½ å¥½ï¼Œè¯·å¸®æˆ‘åˆ†æä¸€ä¸‹...

ğŸ¤– [AI å›å¤ - ç™½è‰²èƒŒæ™¯]
   å½“ç„¶å¯ä»¥ï¼è®©æˆ‘æ¥å¸®æ‚¨åˆ†æ...
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ğŸ“¦ gpt-4  |  ğŸ”¢ 150 tokens
```

## æ ·å¼è®¾è®¡

### é¢œè‰²æ–¹æ¡ˆ

- **æ€è€ƒè¿‡ç¨‹**ï¼šç¥ç€è‰²ç³» (amber-50 to orange-50)
- **ç”¨æˆ·æ¶ˆæ¯**ï¼šç»¿è‰²ç³» (green-50 to emerald-50)
- **AI æ¶ˆæ¯**ï¼šç™½è‰²èƒŒæ™¯
- **å¤´åƒ**ï¼šæ¸å˜è‰²åœ†å½¢

### åŠ¨ç”»æ•ˆæœ

1. **æ·¡å…¥åŠ¨ç”»** - æ–°æ¶ˆæ¯å‡ºç°æ—¶
2. **æ‰“å­—æœºå…‰æ ‡** - æµå¼å†…å®¹æœ«å°¾çš„é—ªçƒå…‰æ ‡
3. **æ—‹è½¬å›¾æ ‡** - æ€è€ƒè¿‡ç¨‹çš„åŠ è½½å›¾æ ‡

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨

```tsx
import AgentChatStream from '../components/AgentChatStream';

function ChatPage() {
  return (
    <AgentChatStream
      agentId="agent-123"
      agentName="AI åŠ©æ‰‹"
      greeting="ä½ å¥½ï¼æˆ‘æ˜¯ AI åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„å—ï¼Ÿ"
    />
  );
}
```

### è‡ªå®šä¹‰å›è°ƒ

```tsx
const {
  messages,
  currentResponse,
  currentReasoning,
  isStreaming,
  sendMessage,
} = useAgentChatStream({
  agentId: 'agent-123',
  onChunk: (chunk) => {
    console.log('æ”¶åˆ°æ•°æ®å—:', chunk);
    if (chunk.reasoning_content) {
      console.log('æ€è€ƒ:', chunk.reasoning_content);
    }
  },
  onComplete: (message) => {
    console.log('æ¶ˆæ¯å®Œæˆ:', message);
  },
  onError: (error) => {
    console.error('é”™è¯¯:', error);
  },
});
```

## API æ•°æ®æ ¼å¼

### SSE æµæ•°æ®æ ¼å¼

```json
// æ€è€ƒè¿‡ç¨‹
data: {
  "type": "content",
  "reasoning_content": "æ­£åœ¨åˆ†æé—®é¢˜...",
  "session_id": "session-123",
  "message_id": "msg-456"
}

// å›å¤å†…å®¹
data: {
  "type": "content",
  "content": "æ ¹æ®åˆ†æç»“æœ...",
  "session_id": "session-123",
  "message_id": "msg-456"
}

// å®Œæˆ
data: {
  "type": "done",
  "reply_id": "reply-789",
  "metadata": {
    "model": "gpt-4",
    "tokens_used": 150
  }
}
```

## æµè§ˆå™¨å…¼å®¹æ€§

- Chrome/Edge: âœ… å®Œå…¨æ”¯æŒ
- Firefox: âœ… å®Œå…¨æ”¯æŒ
- Safari: âœ… å®Œå…¨æ”¯æŒ
- ç§»åŠ¨æµè§ˆå™¨: âœ… å®Œå…¨æ”¯æŒ

## æ€§èƒ½ä¼˜åŒ–

1. **æµå¼æ¸²æŸ“** - å†…å®¹å®æ—¶æ˜¾ç¤ºï¼Œæ— éœ€ç­‰å¾…å®Œæ•´å“åº”
2. **è‡ªåŠ¨æ»šåŠ¨** - æ–°å†…å®¹å‡ºç°æ—¶è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
3. **å–æ¶ˆè¯·æ±‚** - æ”¯æŒä¸­é€”å–æ¶ˆæµå¼è¯·æ±‚
4. **å†…å­˜ç®¡ç†** - æ­£ç¡®æ¸…ç† AbortController å’Œå®šæ—¶å™¨

## æœªæ¥æ”¹è¿›

- [ ] æ”¯æŒ Markdown æ¸²æŸ“
- [ ] æ”¯æŒä»£ç é«˜äº®
- [ ] æ”¯æŒå›¾ç‰‡å’Œæ–‡ä»¶å±•ç¤º
- [ ] æ”¯æŒæ¶ˆæ¯ç¼–è¾‘å’Œé‡æ–°ç”Ÿæˆ
- [ ] æ”¯æŒå¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†
- [ ] æ”¯æŒè¯­éŸ³è¾“å…¥å’Œè¾“å‡º

## ç›¸å…³æ–‡ä»¶

- `frontend/src/hooks/useAgentChatStream.ts` - èŠå¤©æµ Hook
- `frontend/src/components/AgentChatStream.tsx` - èŠå¤©ç»„ä»¶
- `frontend/src/pages/AgentChatStreamPage.tsx` - èŠå¤©é¡µé¢
- `frontend/src/index.css` - æ ·å¼å’ŒåŠ¨ç”»
- `src/infrastructure/llm/streaming.rs` - åç«¯æµå¤„ç†
